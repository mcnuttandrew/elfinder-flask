import sys

from flask import request, session, jsonify
from flask_cors import cross_origin

from felfinder import app
from felfinder.connector import ElFinderConnector

#from config import DISPATCH_DICT

def arg_translate(req):

    cmd = req.args.get('cmd')
    init = req.args.get('init')
    
    # Take the parameters from the dictionary and use them here

    d = {'cmd': cmd, 'init': init}


# NOTE: THIS IS INSECURE ATM BECAUSE IT ALLOWS ALL CROSS_ORIGIN. DISABLE
# WHEN DEVELOPING
    
@app.route("/", methods=['GET', 'POST'])
@cross_origin(supports_credentials=True)
def index():
    
    is_init = request.args.get('init')
    if is_init:
        session['connect'] = ElFinderConnector()

    arg_d = arg_translate(request)
    resp = session['connect'].open(**arg_d)
    
    return jsonify(resp)


        
    
    
